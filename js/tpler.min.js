!function(t,e){"function"==typeof define&&define.amd?define("tpler",[],e):t.tpler=e()}(this,function(){function TimeCom(t){var e;e=""==t?new Date:new Date(t),this.year=e.getFullYear(),this.month=e.getMonth()+1,this.day=e.getDate(),this.hour=e.getHours(),this.minute=e.getMinutes(),this.second=e.getSeconds(),this.msecond=e.getMilliseconds(),this.week=e.getDay()}function template(t){return new template.prototype.init(t)}var reg_tpl_tag=/{=(.*?)(?:\|(.*?))?}/g,reg_operation_symbol=/[\+|\-|\*|\/|\(|\)]+/g,rootEl,$index=1,$length=1,toucher,customFilters={},customSyntax="",customMethods={},customDirectives={},templateConfig={},_syntax="syntax",_group="group",_lazy="lazy",_more="more",_default="default",_data="data",_pagesize="pagesize",_keyword="keyword",_template="template",_noloop="noloop",_loop="loop",_on="on",_model="model",_bind="bind",_tap="tap",_drag="drag",isSupportTouch="ontouchend"in document,supportTouch=function(){try{return document.createEvent("TouchEvent"),!0}catch(t){return!1}}(),_extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),inBrowser="undefined"!=typeof window,UA=inBrowser&&window.navigator.userAgent.toLowerCase(),isIE=UA&&/msie|trident/.test(UA),isIE9=UA&&UA.indexOf("msie 9.0")>0,isEdge=UA&&UA.indexOf("edge/")>0,isAndroid=UA&&UA.indexOf("android")>0,isIOS=UA&&/iphone|ipad|ipod|ios/.test(UA),isChrome=UA&&/chrome\/\d+/.test(UA)&&!isEdge,weixin="micromessenger"==UA.toLowerCase().match(/MicroMessenger/i),envt={inBrowser:inBrowser,UA:UA,isIE:isIE,isIE9:isIE9,isEdge:isEdge,isAndroid:isAndroid,isIOS:isIOS,isChrome:isChrome,weixin:weixin},ArrayProto=Array.prototype,ObjProto=Object.prototype,push=ArrayProto.push,slice=ArrayProto.slice,concat=ArrayProto.concat,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty,nativeForEach=ArrayProto.forEach,nativeMap=ArrayProto.map,nativeFilter=ArrayProto.filter,nativeSome=ArrayProto.some,nativeEvery=ArrayProto.every,nativeIndexOf=ArrayProto.indexOf,_={envt:envt,screen:{x:document.documentElement.clientWidth,y:document.documentElement.clientHeight},toDate:function(t){return/^\d*$/.test(t)?new Date(Number(t)):_.isString(t)?new Date(Date.parse(t.replace(/-/g,"/"))):t},dateAdd:function(t,e,n){var n;switch(n=_.isString(n)?_.toDate(n):new Date(n),t.toLowerCase()){case"y":case"year":return new Date(n.setFullYear(n.getFullYear()+e));case"m":case"month":return new Date(n.setMonth(n.getMonth()+e));case"d":case"day":return new Date(n.setDate(n.getDate()+e));case"w":case"week":return new Date(n.setDate(n.getDate()+7*e));case"h":case"hour":return new Date(n.setHours(n.getHours()+e));case"n":case"min":case"minute":return new Date(n.setMinutes(n.getMinutes()+e));case"s":case"second":return new Date(n.setSeconds(n.getSeconds()+e));case"l":case"ms":case"msecond":return new Date(n.setMilliseconds(n.getMilliseconds()+e))}},dateDiff:function(t,e,n){var r,i=new TimeCom(e),a=new TimeCom(n);switch(String(t).toLowerCase()){case"y":case"year":r=i.year-a.year;break;case"m":case"month":r=12*(i.year-a.year)+(i.month-a.month);break;case"d":case"day":r=Math.round((Date.UTC(i.year,i.month-1,i.day)-Date.UTC(a.year,a.month-1,a.day))/864e5);break;case"h":case"hour":r=Math.round((Date.UTC(i.year,i.month-1,i.day,i.hour)-Date.UTC(a.year,a.month-1,a.day,a.hour))/36e5);break;case"n":case"min":case"minute":r=Math.round((Date.UTC(i.year,i.month-1,i.day,i.hour,i.minute)-Date.UTC(a.year,a.month-1,a.day,a.hour,a.minute))/6e4);break;case"s":case"second":r=Math.round((Date.UTC(i.year,i.month-1,i.day,i.hour,i.minute,i.second)-Date.UTC(a.year,a.month-1,a.day,a.hour,a.minute,a.second))/1e3);break;case"l":case"ms":case"msecond":r=Date.UTC(i.year,i.month-1,i.day,i.hour,i.minute,i.second,i.msecond)-Date.UTC(a.year,a.month-1,a.day,a.hour,a.minute,a.second,i.msecond);break;case"w":case"week":r=Math.round((Date.UTC(i.year,i.month-1,i.day)-Date.UTC(a.year,a.month-1,a.day))/864e5)%7;break;default:r="invalid"}return r},week:function(t){var e=0,n=_.toDate(t);if(!n)return"";var r=(n.getFullYear(),new Array(12));if(r[0]=31,r[2]=31,r[3]=30,r[4]=31,r[5]=30,r[6]=31,r[7]=31,r[8]=30,r[9]=31,r[10]=30,r[11]=31,Math.round(n.getFullYear()/4)==n.getFullYear()/4?r[1]=29:r[1]=28,0==n.getMonth())e+=n.getDate();else{for(var i=n.getMonth(),a=1;a<=i;a++)e+=r[a-1];e+=n.getDate()}var o=Math.round(e/7);return o},month:function(t){var e=_.toDate(t);return e?e.getMonth():""},text:function(t){if(_.isElement(t))return t.innerText},html:function(t){if(_.isElement(t))return t.innerHTML},fast:function(){var t=function(t,e,n){var r,i;r=(new Date).getTime();for(var a=1;a<=n;a++)t.call(this);return i=(new Date).getTime(),console.log("fn {"+t.name+"} _run "+n+" times ,last: "+(i-r)+"ms"),i-r},e=slice.call(arguments),n=e.pop(),r=1e4;_.isNumber(n)?r=n:e.push(n);for(var i=0;i<e.length;i++)e[i]&&t.call(this,e[i],i,r)},pos:function(t){function e(t,e,n){this.x=t,this.y=e,this.time=+new Date,this.el=n,this.width=n.clientWidth,this.height=n.clientHeight,this.rang={top:e,left:t,right:t+this.width,bottom:e+this.height}}function n(t){for(var n=new e(t.offsetLeft,t.offsetTop,t),r=t.offsetParent;r;)n.x+=r.offsetLeft,n.y+=r.offsetTop,r=r.offsetParent;return n}if(_.isElement(t)){var r=t;return n(r)}if(_.isTouchEvent(t)||_.isMouseEvent(t)){var i,a,o=t,r=o.currentTarget,s=o.touches&&o.touches.length>0?o.touches:o.changedTouches;if(s&&0!==s.length){var c=s[0];i=c.pageX,a=c.pageY}else i=o.clientX,a=o.clientY;return new e(i,a,r)}if(_.isString(t)){var r=_.query(t);return _.pos(r)}},drag:function(t){toucher({el:t,type:"drag"})},parseUrl:function(t){var e,n,r,i={},a=location.hash,o=a,t=t||window.location.href;t.replace(/http[s]?:\/\/([^:]*?)(?::(\d+))?\//,function(t,i,a){e=t.substring(0,t.length-1),n=i,r=a});var s=function(){var e=t.match(/#(.*)$/);return e?e[1]:""},c=function(t){return decodeURI(t.replace(/%25/g,"%2525"))},u=function(){var t=location.href.replace(/#.*/,"").match(/\?.+/);return t?t[0]:""},l=function(){var t=c(location.pathname+u()).slice(0);return"/"===t.charAt(0)?t.slice(1):t},h=l();return a=s(),t.replace(/[?&](.+?)=([^&#]*)/g,function(_,t,e){i[t]=decodeURI(e)}),a&&(a=a.length>1?a.replace(/#+/g,"#"):"",o=a.replace(/#/g,"")),{params:i,hash:a,route:o,path:h,domain:e,host:n,port:r}},guid:1,uId:function(){return Math.random().toString(16).slice(2)},random:function(t,e,n){if(_.isArray(t))return t[Math.floor(Math.random()*t.length)];if(_.isNumber(t))return Math.floor(Math.random()*t);for(var r=n||"_",e=e||6,t=t||"abcdefghijklmnopqrstuvwxyz",i=0;i<e;i++)r+=t.charAt(Math.floor(Math.random()*t.length));return r},autoid:function(t,e){var n=function(t){return _.isDocument(t)?t:(_.isElement(t)&&(e?t.setAttribute("id",_.random()):_.isEmpty(t.id)&&t.setAttribute("id",_.random())),t)};if(_.isArray(t)){var r=[];return t.forEach(function(t){r.push(n(t))}),r}return n(t)},query:function(t){var e=slice.call(arguments),n=e.length;if(n>1&&(t=e.join(",")),_.isWindow(t)||_.isDocument(t))return t;if(_.isFunction(t))return t(),[];var r=function(t){if(_.isElement(this)&&(_.autoid(this),this.id)){var e=t.split(","),n="#"+this.id;t=n+e.join(","+n)+","+n+" "+e.join(","+n+" ")}return t};if(_.isElement(t)){if(_.autoid(t),!_.isElement(this))return t;t="#"+t.id,t=r.call(this,t)}else{if(_.isArray(t)){var i=[];return t.forEach(function(t){i.push(_.query(t))}),i}if(_.isJQuery(t)){if(1==t.length)return t.get(0);for(var i=[],a=0;a<t.length;a++)i.push(t.get(a));return i}t=r.call(this,t)}try{var o=document.querySelectorAll(t),e=slice.call(o),n=e.length;if(0==n)return[];if(1==n)return _.autoid(e[0]);if(n>1)return _.autoid(e)}catch(s){console.log(s);var c=t.split(":");return c.length>1?_.query(c[0]).filter(c[1]):[]}},json:function(str){if(_.isEmpty(str))return{};try{return JSON.parse(str)}catch(e1){try{return eval("("+str+")")}catch(e2){return console.log(e2),e2}}},stringify:function(t){var e,n,r=[],i="";if(_.isUndefined(t))i="undefined";else if(_.isBoolean(t))i=t?"true":"false";else if(_.isString(t))i='"'+t+'"';else if(_.isNumber(t))i=t;else if(_.isDocument(t))i="#document";else if(_.isElement(t))i=t.tagName.toLowerCase(),i+=t.id?"#"+t.id:"",i+=t.className?"."+t.className.replace(/\s+/g,"."):"";else if(_.isFunction(t))i="function "+t.prototype.constructor.name+"(){}";else if(_.isArray(t))t.forEach(function(t){r.push(_.stringify(t))}),i="["+r.join(",")+"]";else if(_.isObject(t)){for(e in t)r.push('"'+e+'":'),n=t[e],_.isArray(n)?n.forEach(function(t){r.push(_.stringify(t))}):r.push(_.stringify(n)),r.push(",");r.pop(),i="{"+r.join("")+"}"}else _.isMouseEvent(t)?(i="MouseEvent",i+="("+_.stringify(t.target)+")"):_.isTouchEvent(t)?(i="TouchEvent",i+="("+_.stringify(t.target)+")"):i="unknowtype";return i},toJSONString:function(t){return _.isObject(t)?JSON.stringify(t):t},color:function(){var t="hsl("+Math.ceil(360*Math.random())+",50%,50%)";return console.log(t),t},isHtml:function(t){return/<(\S*?) [^>]*>.*?<\/\1>|<.*?\/?>/.test(t)},enHtml:function(t){return t.replace(/</g,"&lt;").replace(/>/g,"&gt;")},deHtml:function(t){return t.replace(/&lt;/g,"<").replace(/&gt;/g,">")},preHtml:function(t){return t.replace(/\n/g,"<br>").replace(/\r/g,"<br>")},getBody:function(t){var e=/<body[^>]*>([\s\S]*)<\/body>/i,n=t.match(e);return n&&n.length>1?n[1]:t},markdown:function(t){_.isEmpty(t)&&(t='# 标题  ## 标题2  \n*粗体*  **粗体**  _斜体_ \n***分割___分割---  \n> 引用1 \n> 引用2 \n* 列表项目1 \n* 列表项目2 \n- 列表项目1 \n- 列表项目2 \n+ 列表1\n+ 列表2 \n 1. 列表1\n2. 列表2 \n [1连接](www.xxx.com) [2连接](www.xxx.com) [3连接](www.xxx.com) [4连接](www.xxx.com) [5连接](www.xxx.com)\n[Ivan Dementev][]\n[Ivan Dementev]: https://github.com/DiVAN1x \n|表格|字段1|字段2|\n|---|---|---|\n|你好|呵呵|吼吼|\n`for(var i=0;i<10,i++) if(i>=5) alert("")`',console.log(t.replace(/\r?\n/g,"\\r\\n\r\n")));for(var e,n,r=[{tag:"blockquote",reg:/(>\s.+\r?\n)+/g},{tag:"table",reg:/(\|.+\|\r?\n)+/g},{tag:"h6",reg:/#{6}\s(.+)/g},{tag:"h5",reg:/#{5}\s(.+)/g},{tag:"h4",reg:/#{4}\s(.+)/g},{tag:"h3",reg:/#{3}\s(.+)/g},{tag:"h2",reg:/#{2}\s(.+)/g},{tag:"h1",reg:/#{1}\s(.+)/g},{tag:"img",reg:/!\[(.*?)\]\((.*?)\)/g},{tag:"marklink",reg:/\[(.*?)\]\[(.*?)\]/},{tag:"ref",tag:/\[.*?\]:\s+(https?:\/\/.+)/},{tag:"a",reg:/\[(.*?)\]\((.*?)\)|(https?:\/\/.+)/g},{tag:"hr",reg:/[\*|\-|_]{3,}/g},{tag:"strong",reg:/\*\*(.*?)\*\*/g},{tag:"em",reg:/\*(.*?)\*/g},{tag:"i",reg:/[\s\n]_(.*?)_[\s|\n]/g},{tag:"ul",reg:/(?:-\s[\s\S]*)?-\s.*(\r?\n|$)/g},{tag:"ul",reg:/(?:\*\s[\s\S]*)?\*\s.*(\r?\n|$)/g},{tag:"ol",reg:/(\+\s.+\r?\n)+|(\d\.\s.+\r?\n)+/g},{tag:"code",reg:/`([\s\S]+)`/g},{tag:"br",reg:/\r?\n/g}],i=function(t,e){var n=[];n.push("<"),n.push(t);for(var r in e)n.push(" "+r+'="'+e[r]+'"');return n.push(">"),n.join("")},a=function(t){return"</"+t+">"},o=function(t,e,n){return e?i(t,n)+e+a(t):i(t,n)},s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},c=function(){var t=_.keys(s),e=new RegExp("["+t.join("")+"]","g");return this.replace(e,function(t){return s[t]})},u=function(t,e){var n=this;return this.replace(e,function(e,r,i,a){switch(t){case"ref":return"";case"marklink":i=i||r;var s=new RegExp("\\["+i+"\\]:(.*?)\\r?\\n","i"),a=n.match(s)[1];return n=n.replace(s,""),o("a",r,a);case"img":return o(t,null,{alt:r,src:i});case"a":return o(t,r||e,{href:i||a});case"br":case"hr":return o(t);case"blockquote":return e=c.call(e),o(t,e);case"ul":return e=u.call(e,"li",/[\*-]\s([\s\S]+?)(?:\n|$)/g),o(t,e);case"ol":return e=u.call(e,"li",/[(?:\d+\.)|\+]\s(.+)\r?\n/g),o(t,e);case"tr":var l=r.split("|").join("</td><td>");return l=o("td",l),o("tr",l);case"table":e=e.replace(/\|.*[\-]{3,}.*\|[\r?\n]/g,"");var h=u.call(e,"tr",/\|(.+)\|[\r?\n]/g);return o(t,h);case"h1":return o(t,r);case"i":return o(t,r);case"li":return o(t,r);case"code":return r=c.call(r),o(t,r);default:return o(t,r)}})},l=0,h=r.length;l<h;l++)e=r[l].reg,n=r[l].tag,t=u.call(t,n,e);return o("article",t,{"class":"markdown-body entry-content"})},isShow:function(t){return t=_.isElement(t)?t:_.query(t),t.offsetWidth>0||t.offsetHeight>0},isHide:function(t){return t=_.isElement(t)?t:_.query(t),t.offsetWidth<=0&&t.offsetHeight<=0},hasClass:function(t){var e=this;return _.isJQuery(e)&&(e=e.get(0)),!!_.isElement(e)&&_.contains(e.className.split(" "),t)},addClass:function(t){var e=this,n=slice.call(arguments);1==n.length&&t&&(n=t.split(" "));var r=function(){var e=this;_.isString(e)&&(e=_.query(e)),_.isElement(e)?e.className=_.uniq(e.className.split(" ").concat(n)).join(" "):_.isJQuery(e)?e.addClass(t):_.isArray(e)&&_.each(e,function(t){r.call(t)})};if(r.call(e),_.isArray(e)){var i=e.length;if(0==i)return[];1==i&&(e=e[0])}return e},removeClass:function(t){var e=this,n=slice.call(arguments);1==n.length&&t&&(n=t.split(" ")),n.length>1&&n.forEach(function(t){_.removeClass.call(e,t)});var r=function(){var e=this;if(_.isString(e)&&(e=_.query(e)),_.isElement(e)){if(e.hasClass(t)){var n=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(n," ")}}else _.isJQuery(e)?e.removeClass(t):_.isArray(e)&&_.each(e,function(e){r.call(e,t)})};if(r.call(e),_.isArray(e)){var i=e.length;if(0==i)return[];1==i&&(e=e[0])}return e},slice:function(){var t=slice.call(arguments),e=t.length;return 0==e?null:1==e?t[0]:t},hasAttr:function(t,e){return _.isElement(t)?!_.isNull(t.getAttribute(e)):_.isJQuery(t)?"undefined"!=typeof t.attr(e):!!_.isString(t)&&(t=_.query(t),_.hasAttr(t,e))},focus:function(t){t.onfocus=function(){window.setTimeout(function(){var e,n;try{window.getSelection&&document.createRange?(n=document.createRange(),n.selectNodeContents(t),n.collapse(!0),n.setEnd(t,t.childNodes.length),n.setStart(t,t.childNodes.length),e=window.getSelection(),e.removeAllRanges(),e.addRange(n)):document.body.createTextRange&&(n=document.body.createTextRange(),n.moveToElementText(t),n.collapse(!0),n.select())}catch(r){console.log(r)}},1)},t.focus()},type:function(t){if(null===t)return"null";var e=toString.call(t),n=e.match(/\[object (.*?)\]/)[1].toLowerCase();if("number"===n){if(isNaN(t))return"nan";if(!isFinite(t))return"infinity"}return n},isElement:function(t){return!(!t||1!==t.nodeType&&9!==t.nodeType)},isDocument:function(t){return!(!t||!t.nodeName||9!==t.nodeType)},isImage:function(t){return"htmlimageelement"==_.type(t)},isCanvas:function(t){return"htmlcanvaselement"==_.type(t)},isImgLoad:function(t){return isIE?"complete"==t.readyState:t.complete},loadImg:function(t,e){var n;if(_.isImage(t))n=t;else if(_.isCanvas(t)){var r=t;n=new Image,n.src=r.toDataURL("image/jpeg")}else n=new Image,n.src=t;_.isImgLoad(n)?e&&e.call(n,n):(addEvent("load",n,function(){e&&e.call(n,n)}),n.onerror=function(t){console.log("加载图片失败："+t.path[0].src)})},toDataURL:function(t,e){var n=function(t){var n=document.createElement("canvas"),r=n.getContext("2d"),i=t.width,a=t.height;n.width=i,n.height=a,r.drawImage(t,0,0,i,a);var o=new Image;o.onload=function(){e&&e(o)},o.src=n.toDataURL("image/jpeg")};_.loadImg(t,n)},toCanvas:function(t,e){var n=function(t){var n=document.createElement("canvas"),r=n.getContext("2d"),i=t.width,a=t.height;n.width=i,n.height=a,r.drawImage(t,0,0,i,a),e&&e(n)};_.loadImg(t,n)},cutImg:function(t,e,n,r){var e=_.isUndefined(e)?3:e,n=_.isUndefined(n)?3:n,i=function(t){var i=document.createElement("canvas"),a=i.getContext("2d"),o=t.width,s=t.height;i.width=o,i.height=s;for(var c=[],u=o/e,l=s/n,h=0,f=0;f<n;f++)for(var d=0;d<e;d++){a.drawImage(t,d*u,f*l,u,l,0,0,o,s);var p=new Image;p.src=i.toDataURL("image/jpeg"),p.width=u,p.height=l,p.className="thumbnail",p.id="_thumbnail_"+h++,c.push(p)}r&&r(c)};_.loadImg(t,i)},zipImg:function(t){var e=document.createElement("canvas"),n=t.img,r=t.width,i=t.height,a=t.quality,o=t.zoom,s=t.callback;_.loadImg(n,function(){_.isUndefined(r)&&_.isUndefined(i)&&!_.isUndefined(o)&&(r=this.width*o,i=this.height*o),e.width=r,e.height=i;var t=e.getContext("2d");t.drawImage(this,0,0,r,i);var n=new Image;n.src=e.toDataURL("image/jpeg",a),_.loadImg(n,s)})},reverse:function(t,e){var n=function(t){var n=document.createElement("canvas"),r=n.getContext("2d"),i=t.width,a=t.height;n.width=i,n.height=a,r.drawImage(t,0,0);for(var o=r.getImageData(0,0,i,a),s=0;s<o.data.length;s+=4)o.data[s]=255-o.data[s],o.data[s+1]=255-o.data[s+1],o.data[s+2]=255-o.data[s+2],o.data[s+3]=255;r.putImageData(o,0,0);var c=new Image;c.src=n.toDataURL("image/jpeg"),e&&e(c)};_.loadImg(t,n)},masic:function(t,e){},timeSeq:function(t,e,n){t.forEach(function(t,r){!function(r){setTimeout(function(){n&&n(t)},(e||500)*r)}(r)})},background:function(t,e){var t=_.query(t);_.loadImg(e,function(e){t.style.backgroundImage='url("'+e.src+'")'})},isJQuery:function(t){return!!t&&!!t.jquery},has:function(t,e){var n=e.split("."),r=n.length,i=function(t){return Object.prototype.hasOwnProperty.call(this,t)};if(1==r)return i.call(t,e);for(var a=t,o=0;o<r;o++){var s=n.shift().trim();if(!i.call(a,s))return!1;try{a=a[s]}catch(c){return console.log(a,s),console.log(c),!1}}return!0},keys:function(t){if(!_.isObject(t))return[];if(Object.keys)return Object.keys(t);var e=[];for(var n in t)_.has(t,n)&&e.push(n);return e},each:function(t,e,n){if(null==t)return t;if(nativeForEach&&t.forEach===nativeForEach)t.forEach(e,n);else if(t.length===+t.length){for(var r=0,i=t.length;r<i;r++)if(e.call(n,t[r],r,t)==={})return}else for(var a=_.keys(t),r=0,i=a.length;r<i;r++)if(e.call(n,t[a[r]],a[r],t)==={})return;return t},any:function(t,e,n){e||(e=function(t){return t});var r=!1;return null==t?r:nativeSome&&t.some===nativeSome?t.some(e,n):(_.each(t,function(t,i,a){if(r||(r=e.call(n,t,i,a)))return{}}),!!r)},contains:function(t,e){return null!=t&&(t==e||(nativeIndexOf&&t.indexOf===nativeIndexOf?t.indexOf(e)!=-1:_.any(t,function(t){return t===e})))},size:function(t){return null==t?0:t.length===+t.length?t.length:_.keys(t).length},filter:function(t,e,n){var r=[];return null==t?r:nativeFilter&&t.filter===nativeFilter?t.filter(e,n):(_.each(t,function(t,i,a){e.call(n,t,i,a)&&r.push(t)}),r)},max:function(t){var e=slice.call(arguments),n=e.length;n>1&&(t=e);for(var r=_.isArray(t)?t.join(",").split(","):t.split(","),i=0;i<r.length;i++)""==r[i]&&(r.splice(i,1),i--);return r==[]?0:Math.max.apply(Math,r)},min:function(t){var e=slice.call(arguments),n=e.length;n>1&&(t=e);for(var r=_.isArray(t)?t.join(",").split(","):t.split(","),i=0;i<r.length;i++)""==r[i]&&(r.splice(i,1),i--);return r==[]?0:Math.min.apply(Math,r)},extend:function(t){return _.each(slice.call(arguments,1),function(e){if(e)for(var n in e)t[n]=e[n]}),t},extproto:function(t){return _.each(slice.call(arguments,1),function(e){if(e)for(var n in e)if(_.isObject(e[n]))Object.defineProperty(t,n,e[n]);else if(_.isFunction(e[n]))if(t.hasOwnProperty(n))console.log(t,"obj hasOwnProperty "+n);else{t[n]=e[n];var r=Object.getOwnPropertyDescriptor(t,n);r.enumerable=!1,Object.defineProperty(t,n,r)}else t.hasOwnProperty(n)||(t[n]=e[n])}),t},clone:function(t){return _.isObject(t)?_.isArray(t)?t.slice():_.extend({},t):t},invert:function(t){for(var e={},n=_.keys(t),r=0,i=n.length;r<i;r++)e[t[n[r]]]=n[r];return e}};[{key:"hide",reverse:"show"},{key:"active",reverse:"passive"},{key:"disabled",reverse:"available"},{key:"fadeout",reverse:"fadein",type:"animate"},{key:"fadeoutup",reverse:"fadeindown",type:"animate"},{key:"fadeinup",reverse:"fadeoutdown",type:"animate"},{key:"fadeoutleft",reverse:"fadeinright",type:"animate"},{key:"fadeinleft",reverse:"fadeoutright",type:"animate"}].forEach(function(t){_[t.key]=function(){var e=slice.call(arguments);return"animate"==t.type&&_.removeClass.call(e,t.reverse,"hide"),_.addClass.call(e,t.key)},_[t.reverse]=function(){var e=slice.call(arguments);return"animate"==t.type?(_.addClass.call(e,t.reverse),_.removeClass.call(e,t.key,"hide")):_.removeClass.call(e,t.key)}}),["Null","Undefined","Array","String","Number","Boolean","Function","RegExp","NaN","Infinite","NodeList","Arguments","Window","TouchEvent","MouseEvent"].forEach(function(t){_["is"+t]=function(e){return _.type(e)===t.toLowerCase()}}),_.isObject=function(t){return!!_.isElement(t)||"object"===_.type(t)},_.isEmpty=function(t){if(null==t)return!0;if(_.isArray(t)||_.isString(t))return 0===t.length;if(_.isElement(t))return 0==_.size(t);for(var e in t)if(_.has(t,e))return!1;return!0},_.uniq=_.unique=function(t,e,n,r){_.isFunction(e)&&(r=n,n=e,e=!1);var i=n?_.map(t,n,r):t,a=[],o=[];return _.each(i,function(n,r){(e?r&&o[o.length-1]===n:_.contains(o,n))||(o.push(n),a.push(t[r]))}),a},_.identity=function(t){return t},_.every=_.all=function(t,e,n){e||(e=_.identity);var r=!0;return null==t?r:nativeEvery&&t.every===nativeEvery?t.every(e,n):(_.each(t,function(t,i,a){if(!(r=r&&e.call(n,t,i,a)))return breaker}),!!r)},_.intersection=function(t){var e=slice.call(arguments,1);return _.filter(_.uniq(t),function(t){return _.every(e,function(e){return _.contains(e,t)})})},_.difference=function(t){var e=concat.apply(ArrayProto,slice.call(arguments,1));return _.filter(t,function(t){return!_.contains(e,t)})},_.without=function(t){return _.difference(t,slice.call(arguments,1))},_.map=_.collect=function(t,e,n){var r=[];return null==t?r:nativeMap&&t.map===nativeMap?t.map(e,n):(_.each(t,function(t,i,a){r.push(e.call(n,t,i,a))}),r)},_.property=function(t){return function(e){return e[t]}},_.pluck=function(t,e){return _.map(t,_.property(e))},_.indexOf=function(t,e){return _.isUndefined(t)||_.isUndefined(e)?-1:t.toLowerCase().indexOf(e.toLowerCase())};var flatten=function(t,e,n){return e&&_.every(t,_.isArray)?concat.apply(n,t):(_.each(t,function(t){_.isArray(t)||_.isArguments(t)?e?push.apply(n,t):flatten(t,e,n):n.push(t)}),n)};_.flatten=function(t,e){return flatten(t,e,[])},_.getVal=function(t,e){var n="",r=e.split("."),i=r.length;if(_.isObject(t)){if(1==i)n=t[e];else if(n=t[r.shift()],i-=1,_.isObject(n))for(var a=0;a<i;a++)if(n=n[r[a]],_.isUndefined(n))return n="",""}else(_.isString(t)||_.isNumber(t))&&"text"==e&&(n=t);return n},_.$=_.query;var entityMap={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};entityMap.unescape=_.invert(entityMap.escape);var entityRegexes={escape:new RegExp("["+_.keys(entityMap.escape).join("")+"]","g"),unescape:new RegExp("("+_.keys(entityMap.unescape).join("|")+")","g")};_.each(["escape","unescape"],function(t){_[t]=function(e){return null==e?"":(""+e).replace(entityRegexes[t],function(e){return entityMap[t][e]})}}),_.toQueryPair=function(t,e){return encodeURIComponent(String(t))+"="+encodeURIComponent(String(e))},_.toQueryString=function(t){var e=[];for(var n in t)e.push(_.toQueryPair(n,t[n]));return e.join("&")},_.ajax=function(t){function e(){try{i=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{i=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){i=!1}}i||"udefined"==typeof XMLHttpRequest||(i=new XMLHttpRequest)}function n(){if(e(),i)try{i.onreadystatechange=r,"GET"===s.method?(s.data&&(t+=(t.indexOf("?")>-1?"&":"?")+s.data,s.data=null),i.open("GET",t,s.isAsync),i.setRequestHeader("Content-Type",s.contentType||"text/plain;charset=UTF-8"),i.send()):"POST"===s.method?(i.open("POST",t,s.isAsync),i.setRequestHeader("Content-Type",s.contentType||"application/x-www-form-urlencoded;charset=UTF-8"),i.send(s.data)):(i.open(s.method,t,s.isAsync),i.send())}catch(n){console.log(n)}}function r(){if(a)return!0;var e={},n=e.responseText=i.responseText;if(e.responseXML=i.responseXML,e.data=s.data,e.status=i.status,e.uri=t,e.arguments=s.arguments,"json"===s.dataType)try{n=e.responseJSON=JSON.parse(i.responseText)}catch(r){}if(4==i.readyState){switch(i.status){case 200:s.onSuccess.call(n,n);break;default:var o={400:"错误的请求！\nError Code:400!",403:"拒绝请求！\nError Code:403!",404:"请求地址不存在！\nError Code:404!",500:"内部错误！\nError Code:500!",503:"服务不可用！\nError Code:503!"},c=o[i.status]?o[i.status]:"请求返回异常！\nError Code:"+i.status;console.log(c),s.onError(e)}return a=!0}s.onError(e);var u={0:"Uninitialized",1:"Loading",2:"Loaded",3:"Interactive",4:"Complete"};return console.log(t+" ("+u[i.readyState]+")"),!1}var i=!1,a=!1,o=0,s={method:"GET",data:null,arguments:null,onSuccess:function(){},onError:function(){},onComplete:function(){},isAsync:!0,timeout:3e4,contentType:null,dataType:"json"},c=slice.call(arguments),u=c.length;u>=2&&(_.isFunction(c[1])?s=_.extend(s,{onSuccess:c[1]}):_.isObject(c[1])&&(s=_.extend(s,c[1]),_.isObject(s.data)&&(s.data=_.toQueryString(s.data)))),u>=3&&_.isFunction(c[2])&&(s=_.extend(s,{onError:c[2]}));var l=function(){if(!a){if(o>5)return void console.log("请求超时");o++,a=r(),setTimeout(l,10)}};n(),setTimeout(l,15)},_.get=function(t,e){_.ajax(t,e,"GET")},_.post=function(t,e){_.ajax(t,e,"POST")},_.loading=function(t,e,n){if(_.isString(t)&&(t=_.query(t)),_.isElement(t)){var r=["~oo~","^oo^","^oo~","~oo^"],i=!1,a=function(){i||setTimeout(function(){t.query(".tip").text(r.random()),a()},100)};n&&a(),setTimeout(function(){i=!0,t.hide(),e&&e()},1e3)}},_.loadFile=function(t,e,n){var r=t.query("data-file".brackets()),i=function(t,n){_.isFunction(e)?e.call(t,t,n):t.html(n)},a=function(t,e){_.isFunction(n)&&n.call(t,t,e)};_.isElement(r)?_.ajax(r.attr("data-file"),function(t){i(r,t)},function(t){a(r,t)}):_.isArray(r)&&r.forEach(function(t){_.ajax(t.attr("data-file"),function(e){i(t,e)},function(e){a(t,e)})})},_.updateAfterImgLoad=function(t,e){function n(t){a.each(function(){if(0===this.height)return o=!1,!1}),o?(clearTimeout(r),t()):(o=!0,r=setTimeout(function(){n(t)},500))}var r,i=_.query("#"+t),a=i.query("img"),o=!0;a&&a.length>0&&n(function(){e&&e()})},_.polyfill=function(t,e,n){for(var r=0,i=e.length;r<i;r++){var a=t[e[r]];if(_.isFunction(a))return 0==r?a:t[e[0]]=a}return t[e[0]]=n},_.selectorMatches=function(t,e){var n=Element.prototype,r=n.matches||n.webkitMatchesSelector||n.mozMatchesSelector||n.msMatchesSelector||function(t){return[].slice.call(document.querySelectorAll(t)).indexOf(this)!==-1};return r.call(t,e)},_.closest=function(t){for(var e=this;e;){if(e&&_.selectorMatches(e,t))return e;e=e.parentElement}return[]};var obj_prototype={cmd:function(str){if(!_.isString(str))return console.log("object.cmd need a string argument"),"";var self=this,symbol=str.match(reg_operation_symbol),ps=[],_cmd=function(t){if(0==symbol.length)return void ps.push("self."+t);var e=symbol.shift(),n=t.indexOf(e),r=t.substring(0,n).trim();_.has(self,r)?ps.push("self."+r+e):ps.push(r+e);var i=t.substring(n+e.length);_cmd(i)};return _cmd(str),eval(ps.join(""))}},num_prototype={isEqual:function(t,e){return e=void 0==e?10:e,this.toFixed(e)===t.toFixed(e)},add:function(t){var e,n,r;try{e=t.toString().split(".")[1].length}catch(i){e=0}try{n=this.toString().split(".")[1].length}catch(i){n=0}r=Math.pow(10,Math.max(e,n));var a=Math.round(t*r+this*r)/r;return a.isInfinity(function(){console.log(e+" "+n+"  "+this+" "+t)}),a},sub:function(t){var e,n,r,i;try{e=this.toString().split(".")[1].length}catch(a){e=0}try{n=t.toString().split(".")[1].length}catch(a){n=0}return r=Math.pow(10,Math.max(e,n)),i=e>=n?e:n,((this*r-t*r)/r).toFixed(i)},mul:function(t){var e=0,n=t.toString(),r=this.toString();try{e+=n.split(".")[1].length}catch(i){}try{e+=r.split(".")[1].length}catch(i){}return Number(n.replace(".",""))*Number(r.replace(".",""))/Math.pow(10,e)},div:function(t){var e,n,r,i,a=0,o=0;try{a=this.toString().split(".")[1].length}catch(s){}try{o=t.toString().split(".")[1].length}catch(s){}return 0==o&&0==a?r=this/t:(e=Number(this.toString().replace(".","")),n=Number(t.toString().replace(".","")),a<o?(i=Math.pow(10,o-a),r=e/n*i):a>o?(i=Math.pow(10,a-o),r=Math.round(e/n)/i):r=e/n),r.isInfinity(function(){console.log(e+" "+n+" "+(o-a)+" "+this+" "+t)}),r},isInfinity:function(t){var e=function(){return this.toString().indexOf(".")>0&&this.toString().split(".")[1].length>5&&(t&&t.call(this),!0)};return e.call(this)}},str_prototype={pound:function(){return"#"+this},brackets:function(t){if(t){var e;_.isElement(t)?(_.autoid(t),e=t.id):_.isString(t)&&(e=t);var n=this.split(",");return"#"+e+"["+n.join("],#"+e+"[")+"],#"+e+" ["+n.join("],#"+e+" [")+"]"}var n=this.split(",");return"["+n.join("],[")+"]"},format:function(){for(var t=this,e=0,n=arguments.length;e<n;e++)t=t.replace(/{.*?}/,arguments[e]);return t}},dat_prototype={format:function(t){var e,n={"M+":this.getMonth()+1,"d+|D+":this.getDate(),"h+|H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+|Y+)/.test(t)&&(e=RegExp.$1,t=t.replace(e,(this.getFullYear()+"").substr(4-e.length)));for(var r in n)new RegExp("("+r+")").test(t)&&(e=RegExp.$1,t=t.replace(e,1==e.length?n[r]:("00"+n[r]).substr((""+n[r]).length)));return t}},ele_prototype={length:{value:1,writable:!1},query:function(){return _.query.apply(this,arguments)},attr:function(t,e){return e?(this.setAttribute(t,e),this):this.getAttribute(t)},hasAttr:function(t){return!_.isNull(this.getAttribute(t))},remove:function(){this.parentNode&&this.parentNode.removeChild(this)},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)1===t.nodeType&&(this.removeChild(t),t.textContent="");return this},hide:function(){return _.hide(this)},show:function(){return _.show(this)},active:function(){return _.active(this)},passive:function(){return _.passive(this)},removeAttr:function(t){var e=this,n=t.split(","),r=n.length;return 1==r?e.removeAttribute(t):n.forEach(function(t){e.removeAttribute(t)}),e},hasClass:function(t){return _.hasClass.apply(this,arguments)},addClass:function(t){return _.addClass.apply(this,arguments)},removeClass:function(t){return _.removeClass.apply(this,arguments)},html:function(t){var e=slice.call(arguments),n=e.length;return 0==n?this.innerHTML:(this.innerHTML=e[0],this)},text:function(t){return t&&(this.innerText=t),this.innerText},val:function(t){return t?(this.setAttribute("value",t),this):_.contains(["select","input"],this.tagName.toLowerCase())?this.value:this.getAttribute("value")},on:function(t,e){return addEvent(t,this,e),this},off:function(t,e){return removeEvent(t,this,e),this},trigger:function(t){console.log("event trigger");var e=document.createEvent("UIEvents");return e.initEvent(t,!0,!0),dispatchEvent(e,this),this},each:function(t){_.isFunction(t)&&t.call(this,this,0)},css:function(t){var e=arguments.length,n=["font-size","line-height","border-radius","border-width","padding","margin"];["padding","margin",""].forEach(function(t){n=n.concat(["top","left","bottom","right"].map(function(e){return t?t+"-"+e:e}))}),["max","min",""].forEach(function(t){n=n.concat(["width","height"].map(function(e){return t?t+"-"+e:e}))});var r=function(t,e){return/^0$/.test(e)?e:n.indexOf(t)>=0?(""+e).replace(/^\d+(\.\d+)?$/,function(t){return t+"px"}):e};if(1==e){if(_.isObject(t))for(key in t){var i=t[key];i=r(key,i),this.style[key]=i}}else 2==e&&(this.style[t]=arguments[1]);return this},width:function(){return this.offsetWidth},height:function(){return this.offsetHeight},outerWidth:function(){return _.max(this.scrollWidth,this.offsetWidth,this.clientWidth)+Number(this.style.marginLeft)+Number(this.style.marginRight)},dir:function(t,e,n){for(var r=[],i=void 0!==n;(t=t[e])&&9!==t.nodeType;)if(1===t.nodeType){if(i&&jQuery(t).is(n))break;r.push(t)}return r},parent:function(){return this.parentNode},closest:function(t){return _.closest.call(this,t)},sibling:function(t,e){for(var n=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&n.push(t);return n},siblings:function(){return this.sibling((this.parentNode||{}).firstChild,this)},children:function(t){return this.sibling(t.firstChild)},last:function(){return this},isHide:function(){return _.isHide(this)},filter:function(t){switch(t){case"visible":return _.isShow(this)?this:null;case"hidden":return _.isHide(this)?this:null;default:return this}},append:function(t){return _.isElement(t)?this.appendChild(t):void(_.isString(t)&&(this.innerHTML=this.innerHTML+t))},onTap:function(t){toucher({el:this,type:"tap",listener:t})}};ele_prototype.$=ele_prototype.query;var arr_prototype={query:function(t){var e=[];return _.each(this,function(n){if(_.isElement(n)){var r=_.autoid(n).query(t);
_.size(r)>=1&&e.push(r)}}),1==e.length?e[0]:e},each:function(t){_.isFunction(t)&&_.each(this,function(e,n){t.call(e,e,n)})},last:function(){return this[this.length-1]},filter:function(t){var e=[];return _.each(this,function(n,r){var i=n.filter(t);i&&e.push(i)}),e},append:function(t){var e=[];return _.each(this,function(n,r){var i=n.append(t);i&&e.push(i)}),e},random:function(){return this[Math.floor(Math.random()*this.length)]}};arr_prototype.$=arr_prototype.query,["attr","remove","removeAttr","removeClass","addClass","html","on","off","trigger","css","addEvent","hide","show","active","passive","clearEvent"].forEach(function(t){arr_prototype[t]=function(){var e=slice.call(arguments),n=e.length;if(1==n&&_.isString(e[0])){var r=[];return _.each(this,function(n){_.isElement(n)&&r.push(n[t].apply(n,e))}),r}return _.each(this,function(n){_.isElement(n)&&n[t].apply(n,e)}),this}}),Object.prototype=_.extproto(Object.prototype,obj_prototype),Number.prototype=_.extproto(Number.prototype,num_prototype),String.prototype=_.extproto(String.prototype,str_prototype),Date.prototype=_.extproto(Date.prototype,dat_prototype),Element.prototype=_.extproto(Element.prototype,ele_prototype),Array.prototype=_.extproto(Array.prototype,arr_prototype);var addEvent=function(t,e,n){_.isFunction(n)?(window.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n),e.events||(e.events=[]),e.events.push({type:t,el:e,listener:n})):_.isArray(n)&&n.forEach(function(n){addEvent(t,e,n)})},removeEvent=function(t,e,n){if(!_.isElement(e))return!1;if(n){window.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent("on"+t,n),e.events||(e.events=[]);for(var r=e.events.length;r--;)e.events[r].type==t&&e.events[r].listener==n&&e.events.splice(r,1)}else e.events&&e.events.forEach(function(t){removeEvent(t.type,t.el,t.listener)})},startPos={},endPos={},offset={},_touchstart=isSupportTouch?"touchstart":"mousedown",_touchend=isSupportTouch?"touchend":"mouseup",_touchmove=isSupportTouch?"touchmove":"mousemove",containerWidth=document.documentElement.clientWidth>=680?680:document.documentElement.clientWidth,Events=function(){var t=[];return{store:function(e){return e&&t.push(e),t},filter:function(e){return _.filter(t,function(t){var n=!0;for(x in e)t[x]!=e[x]&&(n=!1);return n})},reset:function(){t=[]},on:function(t,e,n,r){var i=this;switch(isSupportTouch||t!=_tap||(t="click"),t){case _tap:var a=function(t){startPos=_.pos(t)},o=function(a){endPos=_.pos(a);var o=endPos.x-startPos.x,s=endPos.y-startPos.y,c=endPos.time-startPos.time;Math.abs(o)<=5&&Math.abs(s)<=5&&c<200&&(_.isFunction(n)?n.call(e,endPos.el,a):_.isArray(n)&&n.forEach(function(t){t.call(e,endPos.el,a)}),r&&i.off(t,e))};addEvent(_touchstart,e,a),addEvent(_touchend,e,o);break;case _drag:case"drag-y":case"drag-x":var s,c=function(t){t.preventDefault()},u=document.documentElement.clientWidth-e.clientWidth,l=document.documentElement.clientHeight-e.clientHeight,a=function(t){startPos=_.pos(t),offset=_.pos(e),e.css({position:"absolute",cursor:"move"}),s=!0,addEvent(_touchmove,document,c)},h=function(n){endPos=_.pos(n),s&&function(){var n=endPos.x-startPos.x+offset.x,r=endPos.y-startPos.y+offset.y;n=_.min(n,u),n=_.max(0,n),r=_.min(r,l),r=_.max(0,r),"drag-y"!=t&&e.css({left:n+"px"}),"drag-x"!=t&&e.css({top:r+"px"})}()},o=function(t){endPos=_.pos(t),s=!1,removeEvent(_touchmove,document,c),_.isFunction(n)&&n.call(e,endPos.el,t)};addEvent("mouseover",e,function(t){e.css({cursor:"move"})}),addEvent("mouseout",e,function(t){e.css({cursor:"normal"})}),addEvent(_touchstart,e,a),addEvent(_touchmove,document,h),addEvent(_touchend,document,o);break;default:var f=function(a){_.isFunction(n)?n.call(e,e,a):_.isArray(n)&&n.forEach(function(t){t.call(e,e,a)}),r&&i.off(t,e)};addEvent(t,e,f)}},off:function(t,e,n){_tap==t?(removeEvent(_touchstart,e),removeEvent(_touchend,e)):removeEvent(t,e,n)}}}(),toucher=window.toucher=function(t){return new toucher.prototype.init(t)};toucher.prototype={constructor:toucher,init:function(t){var e=this;if(!t)return void(0==t&&e._offEvent());var n=[],r=function(t){var r=_.query(t.el),i=t.type||"click",a=!!_.isUndefined(t.clear)||t.clear,o=t.listener||t.callback,s=t.once||!1;_.isElement(r)?(a&&e.clear({el:r,type:i}),n.push({type:i,el:r,listener:o,once:s})):_.isArray(r)&&r.forEach(function(t){a&&e.clear({el:t,type:i}),n.push({type:i,el:t,listener:o,once:s})})};_.isArray(t)?t.forEach(function(t){r(t)}):r(t),e._onEvent(n)},_onEvent:function(t){return t.forEach(function(t){Events.store(t),Events.on(t.type,t.el,t.listener,t.once)}),this},_offEvent:function(t){return Events.filter(t).forEach(function(t){Events.off(t.type,t.el)}),this},clear:function(t){return this._offEvent(t)}},toucher.prototype.init.prototype=toucher.prototype;var walker=window.walker=function(t){return new walker.prototype.init(t)};walker.prototype={constructor:walker,ch:"",pos:0,line:0,col:0,max:0,text:"",escapee:{'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},init:function(t){if(_.isString(t))this.text=t;else if(_.isNumber(t))this.text=""+t;else{if(!_.isObject(t))throw{name:"input error",messasge:'string or {text:""} is required'};this.text=t.text||"",this.debug=t.debug||!1}return this.max=this.text.length,this.line=0,this.col=0,this.pos=0,this.ch=this.peek(),this},parseTable:function(){this.table=[];for(var t,e=[];this.next();)t=this.until("|"),t&&e.push(t),("\n"===this.ch||this.pos>=this.max)&&(this.table.push(e),e=[]);return this.table},peek:function(t){var e=this.text.charAt(this.pos);if(t){e="";for(var n=0;n<=t;n++)e+=this.text.charAt(this.pos+n>=this.max?this.max:this.pos+n)}return e},eof:function(){return""==this.peek()},next:function(t){return t&&t!==this.ch&&error("Expected '"+t+"' instead of '"+this.ch+"'"),this.ch=this.text.charAt(this.pos++),"\n"==this.ch?(this.line++,this.col=0):this.col++,this.debug&&(this.token=this.peek(10)),this.ch},back:function(){return this.ch=this.text.charAt(this.pos--),this.ch},error:function(t){for(var e="",n=10;n--;)this.next(),e+=this.ch;var r={name:"SyntaxError",message:t,pos:this.pos,ch:this.ch,line:this.line,col:this.col,text:this.text,token:e};console.log(r)},info:function(){return{pos:this.pos,ch:this.ch,line:this.line,col:this.col,text:this.text}},until:function(t){var e="",n=this.ch;if(n===t)for(;n=this.next();){if(n===t)return this.back(),e;if("\n"===n){e="";break}e+=n}return e},json:function(){return this._parseJson()},_parseJson:function(){switch(this._skipWhite(),this.ch){case"{":return this._parseObj();case"[":return this._parseArr();case":":return this._parseJson();case'"':case"'":return this._parseStr();default:return/[\d\.-]/.test(this.ch)?this._parseNum():this._parseValue()}},_parseObj:function(){this._skipWhite();var t,e={};if("{"==this.ch)for(;this.next();){if(this._skipWhite(),"}"==this.ch)return this.next(),e;this.ch&&(t=this._parseKey(),Object.hasOwnProperty.call(e,t)&&(this.error("Duplicate key '"+t+"'"),console.log(e)),e[t]=this._parseJson())}return e},_parseArr:function(){this._skipWhite();var t=[];if("["==this.ch)for(;this.next();){if(this._skipWhite(),"]"==this.ch)return this.next(),t;if(this.ch){var e=this._parseJson();if(e&&(t.push(e),"]"===this.ch))return this.next(),t}}return t},_skipWhite:function(){for(;this.ch&&this.ch<=" ";)this.next()},_removeQuote:function(t){return t.replace(/(?:^"(.*)"$)|(?:^'(.*)'$)/,"$1$2")},_parseKey:function(){for(var t=this.ch;this.next();){if(":"==this.ch)return this.next(),this._removeQuote(t);t+=this.ch}},_parseStr:function(){this._skipWhite();var t="",e=this.ch;if("\"'".indexOf(e)>=0)for(;this.next();){if(e==this.ch)return this.next(),t;"\\"===this.ch&&(this.next(),this.escapee[this.ch]&&(t+=this.escapee[this.ch])),t+=this.ch}},_parseNum:function(){if(/[\d\.-]/.test(this.ch)){for(var t=this.ch;this.next();){if(",}]".indexOf(this.ch)>=0)return t=+t;t+=this.ch}return t}},_parseValue:function(){for(var t=this.ch;this.next();){if(",}]".indexOf(this.ch)>=0)return this._removeQuote(t);t+=this.ch}return t}},walker.prototype.init.prototype=walker.prototype;var debug=_.debug=function(t){return new debug.prototype.init(t)};debug.prototype={constructor:debug,init:function(t){var e=document.createElement("div");e.className="_console";var n=document.createElement("div");n.className="_console_handle";var r=document.createElement("div");r.className="_console_log",e.appendChild(n),e.appendChild(r),_.$("body").appendChild(e),console.log=function(){var t=Array.prototype.slice.call(arguments);template({el:"._console_log",act:"append",template:'<div class="_item">{=result}</div>',data:{result:1==t.length?t[0]:t}})},toucher([{el:"._console",type:"drag"},{el:"._console_handle",type:"tap",callback:function(t,e){var n=_.$("._console_log");_.isShow(n)?_.hide(n):_.show(n)}}])}},debug.prototype.init.prototype=debug.prototype;var draw=_.draw=function(t){return new draw.prototype.init(t)};draw.prototype={constructor:draw,init:function(t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.attr(t);var e=t.background||t["background-color"],n=t["background-image"],r=t["background-size"],i=t["background-position"],a=t["background-repeat"];return this.background({color:e,src:n,size:r,position:i,repeat:a}),this.canvas},attr:function(t){for(key in t){if("ratio"==key){var e={x:document.documentElement.clientWidth,y:document.documentElement.clientHeight},n=e.x,r=e.y;switch(t[key]){case"fullscreen":break;default:t[key].replace(/(\d+):(\d+)/,function(t,e,n){h=w*n/e})}this.canvas.setAttribute("width",n),this.canvas.setAttribute("height",r)}["width","height"].indexOf(key)>=0&&(this.canvas[key]=t[key])}},background:function(t){var e=this.canvas,n=this.context,r=t.src,i=t.size,a=t.position,o=t.repeat,s=t.color;s&&(n.fillStyle=s,n.fillRect(0,0,e.width,e.height)),r&&_.loadImg(r,function(t){var r=t.width,s=t.height,c=e.width,u=e.height;switch(i){case"cover":var l=_.max(c/r,u/s),h=r*l,f=s*l;if("center"==a){var d=l<=1?(c-h)/2:-(c-h)/2,p=l<=1?(u-f)/2:-(u-f)/2;n.drawImage(t,d,p,h,f)}else n.drawImage(t,0,0,h,f);break;case"contain":var l=_.min(c/r,u/s),h=r*l,f=s*l;if("center"==a){var d=(c-h)/2,p=(u-f)/2;n.drawImage(t,d,p,h,f)}else n.drawImage(t,0,0,h,f);"repeat"==o&&_.zipImg({img:t,zoom:l,callback:function(){var t=n.createPattern(this,"repeat");n.fillStyle=t,n.fillRect(0,0,e.width,e.height),n.fill()}});break;case"stretch":n.drawImage(t,0,0,e.width,e.height);break;case"auto":n.drawImage(t,0,0);break;default:n.drawImage(t,0,0)}})}},draw.prototype.init.prototype=draw.prototype;var router=window.router=function(t){return new router.prototype.init(t)};router.prototype={constructor:router,_pageStack:[],_configs:[],_pageAppend:function(){},_defaultPage:null,_pageIndex:1,routes:{},defaultAction:"home",init:function(t){var e=this;t&&(this.routes=t),addEvent("hashchange",window,function(){var t=e.parseUrl();e._go(t.route)}),history.state&&history.state._pageIndex&&(this._pageIndex=history.state._pageIndex),this._pageIndex--;var n=0===location.hash.indexOf("#")?location.hash:"#",r=e._find("url",n)||e._defaultPage;return this._go(r),this},getAction:function(t){return this.routes[t]?this.routes[t]:this.defaultAction},getSearch:function(){var t=location.href.replace(/#.*/,"").match(/\?.+/);return t?t[0]:""},getHash:function(){var t=location.href.match(/#(.*)$/);return t?t[1]:""},decodeFragment:function(t){return decodeURI(t.replace(/%25/g,"%2525"))},getPath:function(){var t=this.decodeFragment(location.pathname+this.getSearch()).slice(0);return"/"===t.charAt(0)?t.slice(1):t},parseUrl:function(){var t={},e=location.href,n=location.hash,r=n,i=function(){var t=location.href.match(/#(.*)$/);return t?t[1]:""},a=this.getPath();return n=i(),e.replace(/[?&](.+?)=([^&#]*)/g,function(_,e,n){t[e]=decodeURI(n)}),n&&(n=n.length>1?n.replace(/#+/g,"#"):"",r=n.replace(/#/g,"")),{params:t,hash:n,route:r,path:a}},push:function(t){return this._configs.push(t),this},go:function(t){t&&(location.hash=t)},_go:function(t){this._pageIndex++,history.replaceState&&history.replaceState({_pageIndex:this._pageIndex},"",location.href);var e=this.getAction(t);_.isFunction(e)?e.call(this):console.log(e),console.log(this._pageIndex)},back:function(){history.back()},_back:function(t){this._pageIndex--;var e=this._pageStack.pop();if(e){var n=0===location.hash.indexOf("#")?location.hash:"#",r=this._findInStack(n);if(!r){var i=_.$(t.template).addClass("js_show").addClass(t.name);i.insertBefore(e.dom),t.isBind||this._bind(t),this._pageStack.push({config:t,dom:i})}return this}},_findInStack:function(t){for(var e=null,n=0,r=this._pageStack.length;n<r;n++){var i=this._pageStack[n];if(i.config.url===t){e=i;break}}return e},_find:function(t,e){for(var n=null,r=0,i=this._configs.length;r<i;r++)if(this._configs[r][t]===e){n=this._configs[r];break}if(!n){var n={template:e,id:e,url:e};n[t]=e,this.push(n)}return n},_bind:function(t){var e=t.events||{};for(var n in e)for(var r in e[n]);t.isBind=!0}},router.prototype.init.prototype=router.prototype;var StandardFilters={string:function(t){return(_.isArray(t)||_.isObject(t))&&(t=_.stringify(t)),t},first:function(t){return _.isArray(t)&&(t=t[0]),t},last:function(t){return _.isArray(t)&&(t=t[t.length-1]),t},pre:function(t){return _.preHtml(t)},"int":function(t){return _.isNumber(Number(t))?Math.round(Number(t)):t},number:function(t){return Number(t)},wan:function(t){return Number(t)>1e4?(Number(t)/1e4).toFixed(1)+"万":t},fixed:function(t){return Number(t).toFixed(1)},cent:function(t){return(Number(t)/100).toFixed(2)},percent:function(t){return Math.ceil(100*t)+"%"},yearmonth:function(t){return new Date(Number(t)).format("YYYY年MM月")},monthdaytime:function(t){return new Date(Number(t)).format("MM月DD日 HH:mm")},datetime:function(t){return new Date(Number(t)).format("YYYY-MM-DD HH:mm")},date:function(t){return new Date(Number(t)).format("YYYY-MM-DD")},time:function(t){return new Date(Number(t)).format("HH:mm")},avatar:function(t){return t?' style="background-image: url('+t+');"':""},file:function(t){return"<div data-file='"+t+"'></div>"},text:function(t){return _.escape(t)}};["markdown","escape","unescape"].forEach(function(t){StandardFilters[t]=function(e){return _[t](e)}}),["round","ceil","floor"].forEach(function(t){StandardFilters[t]=function(e){return _.isNumber(Number(e))?Math[t](Number(e)):e}});var callFilter=function(t,e,n){if(e){var r=this,i=function(t,e,n){var i=customFilters[e];if(_.isUndefined(i))return t;if(_.isFunction(i))t=i.call(r,t,n);else try{var a=new Function("return ("+i+".call(this,arguments[0]));");t=a.call(r,t,n)}catch(o){try{var a=new Function("data","return ("+i+");");t=a.call(r,t,n)}catch(o){t=i}}return t},a=e.split(","),o=a.length;o>0&&"string"!=a[o-1]&&(a.push("string"),o++),1==o?t=i.call(r,t,e,n):o>1&&a.forEach(function(e){t=i.call(r,t,e,n)})}return t},regModel=/<[^>]+?model=\"(.*?)\".*?(>.*?<)\/[^>]+?>/gi,regbind=/<[^>]+?bind=\"(.*?)\".*?(>.*?<)\/[^>]+?>/gi,preModel=function(t){var e=new RegExp([regModel.source,regbind.source].join("|")+"|$","gi");return t.replace(e,function(t,e,n,r,i){return e=e||r,n=n||i,t.replace(n,">{="+e+"}<")})},parseTag=_.parseTag=function(tpl,data){var self=this;return tpl.replace(reg_tpl_tag,function(match,name,filter){name=name.trim(),filter=(filter||"string").trim();var val="";try{if(0==filter.indexOf("$")&&(filter=eval("data."+filter.replace("$",""))),"$index"==name.toLowerCase())return $index++;if("$length"==name.toLowerCase())return $length;val=reg_operation_symbol.test(name)?data.cmd(name):_.getVal(data,name)}catch(e){console.log(e,data)}return _.isUndefined(val)&&(val=""),val=callFilter.call(self,val,filter,data)})},parseTpl=_.parseTpl=function(t){var e=t||this,n=e.tpl||getTpl(e.template),r=e.groupTpl,i=e.lazyTpl,a=e.moreTpl,o=e.defaultTpl,s=e.loop,c=e.syntax,u=e.data;if(_.isEmpty(n)&&_.isEmpty(r))return"";n&&function(){n=preModel(n)}(),$index=1;var l="";if(_.isUndefined(u))h=0,l=_.isUndefined(o)?n:o;else if(_.isArray(u)){var h=u.length,f=Number(s)||h;(a||i)&&f>=h&&(f=3);for(var d=[],p="",g="",m=0;m<h;m++){var v=u[m];if(!_.isUndefined(r)&&function(){g=parseTag.call(e,r,v),g!=p&&d.push(g),p=g}(),m>=f){if(!_.isUndefined(a)){d.push(parseTag.call(e,a,v));break}if(_.isUndefined(i))break;d.push(parseTag.call(e,i,v))}else n&&d.push(parseTag.call(e,n,v))}l=d.join("")}else _.isObject(u)?(h=1,n&&function(){l=parseTag.call(e,n,u)}()):(h=1,l=n);var c=c||customSyntax;switch(c){case"markdown":l=_.markdown(l);break;case"pre":l=_.preHtml(l)}return l},getTpl=_.getTpl=function(t){if(t){var e=_.query(t.pound());return e&&e.length>0?_.text(e).trim():null}return null},elTpl=function(t){var e,n;return _.hasAttr(this,t)&&(n=this.attr(t),e="this"==n||_.isEmpty(n)?_.html(this).trim():getTpl(n)),e},parseEl=function(){var self=this,tpl,syntax,groupTpl,lazyTpl,moreTpl,defaultTpl,loop,el=self.el,data=self.data,act=self.act,keyword=self.keyword;if(self.tpl=self.template||elTpl.call(el,_template),[_group,_lazy,_more,_default].forEach(function(t){self.templates&&!_.isUndefined(self.templates[t])?self[t+"Tpl"]=self.templates[t]:self[t+"Tpl"]=elTpl.call(el,t)}),self.tpl)loop="auto";else if(self.groupTpl);else if(tpl=el.html(),loop="1",!reg_tpl_tag.test(tpl))return parseDirective.call(self,el,data),!1;if(_.hasAttr(el,_syntax)&&(syntax=el.attr(_syntax)),_.hasAttr(el,_noloop)&&(loop="1"),_.hasAttr(el,_loop)&&(loop=el.attr(_loop)),_.hasAttr(el,_pagesize)&&(loop=el.attr(_pagesize)),_.hasAttr(el,_data)){var child=el.attr(_data);_.contains(_.keys(data),child.split(".")[0])&&(data=eval("data."+child))}if(_.isArray(data)&&keyword&&_.hasAttr(el,_keyword)){var name=el.attr(_keyword);data=_.filter(data,function(t){var e=name.split(",");if(1==e.length)return _.indexOf(_.getVal(t,name),keyword)>=0;var n=!1;return e.forEach(function(e){_.indexOf(_.getVal(t,e),keyword)>=0&&(n=!0)}),n})}$length=_.isArray(data)?data.length:_.isUndefined(data)?0:(_.isObject(data),1);var tplConfig=_.extend({},self,{data:data,loop:loop,syntax:syntax}),str=parseTpl.call(tplConfig);switch(act){case"append":str=el.html()+str;break;case"before":str+=el.html()}(self.tpl||el.attr(_template)||el.attr(_group))&&el.html(str),parseDirective.call(self,el,data)},StandardDirectives={},parseDirective=function(t,e){var n=this,r=t.query(_model.brackets()),i=function(t,e){if(_.isElement(this)){var r=this.attr(_on),i=n.methods[r];i&&_.isFunction(i)&&i.call(n,this,e)}};StandardDirectives[_on]=i;var a;_.each(StandardDirectives,function(e,r){if(a=r==_drag?_drag:_tap,_on!=r){var i=function(t,e){var i=n.methods["_on_"+r];i&&_.isFunction(i)&&i.call(n,t,e)};toucher({el:r.brackets(t),type:a,clear:!0,listener:i})}else toucher({el:r.brackets(t),type:a,clear:!0,listener:e})}),r&&r.length>0&&r.each(function(t,e){var n=this.attr(_model),r=_.query(this).val();template.prototype[n]=r;var i=_.clone(template.prototype);Object.defineProperty(template.prototype,n,{set:function(t){var e=i[n];i[n]=t,t!=e&&template.prototype.apply(n,t)},get:function(){return i[n]},enumerable:!0,configurable:!0})}),r&&r.length>0&&r.on("keyup",function(){var e=_.query(this).val(),n=this.attr(_model);t.query(_model.brackets()).html(e),console.log(e,n),template.prototype[n]=e})};return template.prototype={constructor:template,init:function(t){var e=this,n=slice.call(arguments),r=n.length;switch(r){case 0:if(_.isEmpty(e.el))return;break;case 1:if(_.isArray(t))return void t.forEach(function(t){template(t)});_.isObject(t)&&_.each(t,function(n,r){switch(r){case"el":if(e.el=t.el,_.isString(e.el)&&(e.selector=e.el,e.el=_.query(e.el)),_.isJQuery(e.el))if(1==e.el.length)e.el=_.autoid(e.el.get(0));else{var i=[];e.el.each(function(t,e){i.push(_.autoid(t))}),e.el=i}if(!(_.isElement(e.el)||_.isArray(e.el)&&_.size(e.el)>0))return console.log("not query el"+t.el),e.el=document.createElement("div"),e.el.id=t.el.replace("#",""),t.template&&e.el.setAttribute("template",t.template.replace("#","")),t.container?_.query(t.container).appendChild(e.el):document.body.appendChild(e.el),!1;rootEl=e.el;break;case"data":e.data=t.data,_.isFunction(t.data)&&(e.data=t.data()),_.isObject(e.data)||_.isArray(e.data)||(e.data={});break;case"syntax":e.syntax=customSyntax=t.syntax;break;case"methods":e.methods=_.extend({},customMethods,n);break;default:e[r]=n}});break;default:throw new Error("invalid options ,formate should be likes: {el:el,data:data}")}customFilters=_.extend({},StandardFilters,e.filters),StandardDirectives=_.extend({},StandardDirectives,e.directives),e=_.extend({methods:{}},e),_.each(e.directives,function(t,n){e.methods["_on_"+n]=t}),t=_.extend({},t,{el:e.el,methods:e.methods}),_.isFunction(e.before)&&e.before.call(e,e.data);var i=e.el;if("cloneBefore"==e.act){var a=_.autoid(e.el.cloneNode(!0),!0);e.el.parentNode.insertBefore(a,e.el),t.act="",i=t.el=a}if("cloneAfter"==e.act){var a=_.autoid(e.el.cloneNode(!0),!0);e.el.parentNode.appendChild(a,e.el),t.act="",i=t.el=a}if(_.isElement(i)?e.parser.call(t,i):_.isArray(i)&&_.size(i)>0&&i.each(function(n,r){e.parser.call(_.extend({},t,{el:n}),n)}),_.isFunction(e.callback)&&e.callback.call(t,e.data),e.events)if(_.isFunction(e.events))toucher({el:i,type:"tap",clear:!0,listener:e.events});else if(_.isObject(e.events)){var o=[];for(x in e.events)o.push({el:i,type:x,listener:e.events[x]});toucher(o)}},parser:function(t){var e=this;if(e.template||_.hasAttr(t,_template)||_.hasAttr(t,_group))parseEl.call(e);else{var n=t.query(_template.brackets(),_group.brackets());_.size(n)>0&&n.each(function(t,n){parseEl.call(_.extend({},e,{el:t}))})}},apply:function(t,e){var n=function(t,e){return t+"='"+e+"'"},r=[];r.push(n(_model,t).brackets()),r.push(n(_bind,t).brackets());var i=r.join(",");rootEl.query(i).each(function(t,n){switch(console.log(this.tagName,t),this.tagName.toLowerCase()){case"div":_.query(this).html(e);break;case"input":_.query(this).val(e)}})}},template.prototype=_.extend({},template.prototype,_),template.prototype.init.prototype=template.prototype,window._||(window._=_),template});