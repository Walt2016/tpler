<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>bg</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,minimal-ui">
    <script src="js/tpler.js"></script>
    <link rel="shortcut icon" type="image/x-icon" href="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7">
    <style>
    .box {
        width: 100%;
        height: 98vh;
        background-color: rgba(255, 255, 255, 0.5);
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        -webkit-box-pack: center;
        -ms-flex-pack: center;
                justify-content: center;
        -webkit-box-align: center;
        -ms-flex-align: center;
                align-items: center;
        font-size: 20px;
        color: #000
    }
    </style>
</head>

<body>
    <div class="box"></div>
    <script>
    var timer;
    var timeoutFlag = false;
    var canvas = document.createElement("canvas");
    var ctx = canvas.getContext("2d");
    var bg = function(color) {
        timer && clearTimeout(timer);
        var color = color || _.color();
        if (timeoutFlag) {

            document.body.css({
                backgroundImage: "none",
                backgroundColor: color
            })
            return;
        }


        var width = 20; //originImg.width;
        var height = 20; //originImg.height;
        canvas.width = width;
        canvas.height = height;
        // // ctx.drawImage(originImg, 0, 0, width, height);
        ctx.fillStyle = color // "#ccc";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        var line = new Path2D();
        line.width = 0.5;
        line.moveTo(0, 0);
        line.lineTo(canvas.width, canvas.height);
        line.moveTo(canvas.width, 0);
        line.lineTo(0, canvas.height);


        // line.lineTo(10, canvas.height - 5);
        // line.lineTo(canvas.width - 5, canvas.height - 5);
        ctx.stroke(line);


        // var circle = new Path2D();
        // circle.arc(5, 5, 5, 0, 2 * Math.PI);
        // circle.arc(15, 15, 5, 0, 2 * Math.PI);
        // ctx.stroke(circle);

        var img = new Image();
        img.onload = function() {
            // callback && callback(img);
            // console.log(img)
            document.body.css({
                backgroundRepeat: "repeat",
                backgroundImage: "url('" + img.src + "')"
            })

            _.$("link").attr("href", img.src);
            _.$(".box").html(color)
            // document.body.style.backgroundRepeat="repeat"
            // document.body.style.backgroundImage = "url('" + img.src + "')"
        }
        img.src = canvas.toDataURL('image/png'); //quality

        timer = setTimeout(function() {
            bg();
        }, 1000)
        // window.requestAnimationFrame(bg)

    }

    var nowTime, startTime, duration;

    toucher([{
        el: document,
        type: "touchstart",
        callback: function(item, ev) {
            timeoutFlag = false;
            bg();
            startTime = +new Date();

        }
    }, 
    // {
    //     el: document,
    //     type: "touchmove",
    //     callback: function(item, ev) {
    //         timeoutFlag = false;
    //         nowTime = +new Date();
    //         duration = nowTime - startTime;
    //         if (duration > 1000) {
    //             bg(_.color());
    //             startTime = +new Date();
    //         }

    //     }
    // }, 
    {
        el: document,
        type: "touchend",
        callback: function(item, ev) {
            timeoutFlag = true;
        }
    }])
    </script>
</body>

</html>