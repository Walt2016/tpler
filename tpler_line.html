<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,minimal-ui">
    <title>cavans line</title>
    <script src="js/tpler.js"></script>
</head>

<body>
    <script>
    var discs = [{
                x: 150,
                y: 50,
                lastX: 150,
                lastY: 50,
                velocityX: 3.2,
                velocityY: 3.5,
                radius: 25,
                innerColor: 'rgba(0,255,255,0.3)',
                middleColor: 'rgba(0,255,255,0.9)',
                outerColor: 'rgba(0,255,255,0.3)',
                strokeStyle: 'slateblue',
            },

            {
                x: 75,
                y: 200,
                lastX: 75,
                lastY: 200,
                velocityX: 2.2,
                velocityY: 2.5,
                radius: 25,
                innerColor: 'rgba(225,225,225,0.1)',
                middleColor: 'rgba(225,225,225,0.9)',
                outerColor: 'rgba(225,225,225,0.3)',
                strokeStyle: 'gray'
            },

            {
                x: 100,
                y: 300,
                lastX: 150,
                lastY: 50,
                velocityX: 1.2,
                velocityY: 1.5,
                radius: 25,
                innerColor: 'orange',
                middleColor: 'yellow',
                outerColor: 'gold',
                shadowColor: 'rgba(255,0,0,0.7)',
                strokeStyle: 'orange'
            },
        ],
        numDiscs = discs.length,
        lastTime = 0,
        frameCount = 0;
    var canvas = document.createElement("canvas");
    var context = canvas.getContext("2d");
    // var context = document.getElementById('canvas').getContext('2d'),
    var moveToFunction = CanvasRenderingContext2D.prototype.moveTo;

    CanvasRenderingContext2D.prototype.lastMoveToLocation = {};

    CanvasRenderingContext2D.prototype.moveTo = function(x, y) {
        moveToFunction.apply(context, [x, y]);
        this.lastMoveToLocation.x = x;
        this.lastMoveToLocation.y = y;
    };

    CanvasRenderingContext2D.prototype.dashedLineTo = function(x, y, dashLength) {
        dashLength = dashLength === undefined ? 5 : dashLength;

        var startX = this.lastMoveToLocation.x;
        var startY = this.lastMoveToLocation.y;

        var deltaX = x - startX;
        var deltaY = y - startY;
        var numDashes = Math.floor(Math.sqrt(deltaX * deltaX + deltaY * deltaY) / dashLength);

        for (var i = 0; i < numDashes; ++i) {
            this[i % 2 === 0 ? 'moveTo' : 'lineTo']
                (startX + (deltaX / numDashes) * i, startY + (deltaY / numDashes) * i);
        }

        this.moveTo(x, y);
    };

    context.lineWidth = 3;
    context.strokeStyle = 'blue';

    context.moveTo(20, 20);
    context.dashedLineTo(context.canvas.width - 20, 20);
    context.dashedLineTo(context.canvas.width - 20, context.canvas.height - 20);
    context.dashedLineTo(20, context.canvas.height - 20);
    context.dashedLineTo(20, 20);
    context.dashedLineTo(context.canvas.width - 20, context.canvas.height - 20);
    context.stroke();


    function drawGrid(context, color, stepx, stepy) {
        context.strokeStyle = color;
        context.lineWidth = 0.5;

        for (var i = stepx + 0.5; i < context.canvas.width; i += stepx) {
            context.beginPath();
            context.moveTo(i, 0);
            context.lineTo(i, context.canvas.height);
            context.stroke();
        }

        for (var i = stepy + 0.5; i < context.canvas.height; i += stepy) {
            context.beginPath();
            context.moveTo(0, i);
            context.lineTo(context.canvas.width, i);
            context.stroke();
        }
    }

    // Initialization................................................

    drawGrid(context, 'lightgray', 10, 10);


    function Quadratic() {
        context.fillStyle = 'cornflowerblue';
        context.strokeStyle = 'yellow';

        context.shadowColor = 'rgba(50, 50, 50, 1.0)';
        context.shadowOffsetX = 2;
        context.shadowOffsetY = 2;
        context.shadowBlur = 4;

        context.lineWidth = 20;
        context.lineCap = 'round';

        context.beginPath();
        context.moveTo(120.5, 130);
        context.quadraticCurveTo(150.8, 130, 160.6, 150.5);
        context.quadraticCurveTo(190, 250.0, 210.5, 160.5);
        context.quadraticCurveTo(240, 100.5, 290, 70.5);
        context.stroke();


    }

    Quadratic();



    function drawHorizontalLine(y) {
        context.beginPath();
        context.moveTo(0, y + 0.5);
        context.lineTo(context.canvas.width, y + 0.5);
        context.stroke();
    }

    function drawVerticalLine(x) {
        context.beginPath();
        context.moveTo(x + 0.5, 0);
        context.lineTo(x + 0.5, context.canvas.height);
        context.stroke();
    }

    function drawGuidewires(x, y) {
        context.save();
        context.strokeStyle = 'rgba(0,0,230,0.4)';
        context.lineWidth = 0.5;
        drawVerticalLine(x);
        drawHorizontalLine(y);
        context.restore();
    }



    // Save and restore drawing surface..............................

    function saveDrawingSurface() {
        drawingSurfaceImageData = context.getImageData(0, 0,
            canvas.width,
            canvas.height);
    }

    function restoreDrawingSurface() {
        context.putImageData(drawingSurfaceImageData, 0, 0);
    }

    // drawGuidewires(0, 0)
    function fillCanvas(color) {
        context.fillStyle = color;
        context.fillRect(0, 0, canvas.width, canvas.height);
    }
    fillCanvas('lightgray');

    function eraseBackground() {
        context.clearRect(0, 0, canvas.width, canvas.height);
    }

    function drawBackground() {
        var STEP_Y = 12,
            i = context.canvas.height;

        context.strokeStyle = 'lightgray';
        context.lineWidth = 0.5;

        context.save();
        context.restore();

        while (i > STEP_Y * 4) {
            context.beginPath();
            context.moveTo(0, i);
            context.lineTo(context.canvas.width, i);
            context.stroke();
            i -= STEP_Y;
        }

        context.save();

        context.strokeStyle = 'rgba(100,0,0,0.3)';
        context.lineWidth = 1;

        context.beginPath();

        context.moveTo(35, 0);
        context.lineTo(35, context.canvas.height);
        context.stroke();

        context.restore();
    }

    drawBackground()


    function update() {
        var disc = null;

        for (var i = 0; i < numDiscs; ++i) {
            disc = discs[i];

            if (disc.x + disc.velocityX + disc.radius > context.canvas.width ||
                disc.x + disc.velocityX - disc.radius < 0)
                disc.velocityX = -disc.velocityX;

            if (disc.y + disc.velocityY + disc.radius > context.canvas.height ||
                disc.y + disc.velocityY - disc.radius < 0)
                disc.velocityY = -disc.velocityY;

            disc.x += disc.velocityX;
            disc.y += disc.velocityY;
        }
    }

    function draw() {
        var disc; //= discs[i];

        for (var i = 0; i < numDiscs; ++i) {
            disc = discs[i];

            gradient = context.createRadialGradient(disc.x, disc.y, 0,
                disc.x, disc.y, disc.radius);

            gradient.addColorStop(0.3, disc.innerColor);
            gradient.addColorStop(0.5, disc.middleColor);
            gradient.addColorStop(1.0, disc.outerColor);

            context.save();
            context.beginPath();
            context.arc(disc.x, disc.y, disc.radius, 0, Math.PI * 2, false);
            context.fillStyle = gradient;
            context.strokeStyle = disc.strokeStyle;
            context.fill();
            context.stroke();
            context.restore();
        }
    }


    window.requestNextAnimationFrame = function() {
        return window.requestAnimationFrame ||
            window.webkitRequestAnimationFrame ||
            window.mozRequestAnimationFrame ||
            window.oRequestAnimationFrame ||
            window.msRequestAnimationFrame ||

            function(callback, element) {
                var start,
                    finish;

                window.setTimeout(function() {
                    start = +new Date();
                    callback(start);
                    finish = +new Date();

                    self.timeout = 1000 / 60 - (finish - start);

                }, self.timeout);
            };
    }


    function animate(time) {
        // if (!paused) {
        context.clearRect(0, 0, canvas.width, canvas.height);
        drawBackground();
        update();
        draw();

        // context.fillStyle = 'cornflowerblue';
        // context.fillText(calculateFps().toFixed() + ' fps', 45, 50);

        window.requestNextAnimationFrame(animate);
        // }
    }

    // draw()
    animate()

    document.body.appendChild(canvas)

    toucher({
        el: "canvas",
        type: "touchmove",
        callback: function(item, ev) {
            var pos = _.pos(ev);
            drawGuidewires(pos.x, pos.y)
        }
    })
    </script>
</body>

</html>