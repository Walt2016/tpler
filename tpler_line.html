<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,minimal-ui">
    <title>cavans line</title>
    <script src="js/tpler.js"></script>
    <link rel="shortcut icon" type="image/x-icon" href="data:image/gif;base64,YQ==">
    <style>
    html,
    body {
        margin: 0;
        padding: 0;
    }
    </style>
</head>

<body>
    <script>
    (function() {
        var lastTime = 0;
        var vendors = ['ms', 'moz', 'webkit', 'o'];
        for (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {
            window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];
            window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] || window[vendors[x] + 'CancelRequestAnimationFrame'];
        }
        if (!window.requestAnimationFrame) window.requestAnimationFrame = function(callback, element) {
            var currTime = new Date().getTime();
            var timeToCall = Math.max(0, 16 - (currTime - lastTime));
            var id = window.setTimeout(function() {
                callback(currTime + timeToCall);
            }, timeToCall);
            lastTime = currTime + timeToCall;
            return id;
        };
        if (!window.cancelAnimationFrame) window.cancelAnimationFrame = function(id) {
            clearTimeout(id);
        };
    }());
    // var _canvas = function(opt) {
    //     var h = screen.availHeight
    //     var w = screen.availWidth
    //     var c = document.createElement("canvas");
    //     if (opt == "fullscreen") {

    //     } else if (/\d+:\d+/.test(opt)) { //比率


    //         opt.replace(/(\d+):(\d+)/, function(match, x, y) {

    //             h = w *  y/x

    //         })

    //     }

    //     c.setAttribute('width', w);
    //     c.setAttribute('height', h);

    //     return c;


    // }

    // var canvas=_canvas("4:3")

    var canvas = _.draw({
        ratio: "4:3",
        background: "#ccc"
    })

    document.body.appendChild(canvas)
    var context = canvas.getContext("2d");


    var x = 0,
        y = 0;

    var lastX, lastY;
    context.lineWidth = 2

    var _line = function() {
        lastX = _.random(canvas.width);
        lastY = _.random(canvas.height);
        context.beginPath();
        context.moveTo(x, y);
        context.lineTo(lastX, lastY);
        context.strokeStyle = _.color();
        context.stroke();

        x = lastX;
        y = lastY;
    }

    // var len = 10;
    // while (len--) {
    //     _line()
    // }
    var id;
    var _movie = function() {
        _line();
        id = requestAnimationFrame(_movie)
    }

    var _clear = function() {
        context.fillStyle = "#ccc";
        context.fillRect(0, 0, canvas.width, canvas.height);
    }

    var _stop = function() {
        id && cancelAnimationFrame(id)
    }



    var nowTime = +new Date();
    var endTime = +new Date();

    //dbclick



    toucher([{
        el: "canvas",
        type: "touchstart",
        callback: function(item, ev) {
            // var pos = _.pos(ev);
            // drawGuidewires(pos.x, pos.y)

            _movie();
        }
    }, {
        el: "canvas",
        type: "touchend",
        callback: function() {
            _stop();

        }

    }])
    </script>
</body>

</html>