+<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>polyfill</title>
</head>

<body>
    <script>
    // http://paulirish.com/2011/requestanimationframe-for-smart-animating/
    // http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating
    // requestAnimationFrame polyfill by Erik Möller. fixes from Paul Irish and Tino Zijdel
    // MIT license
    (function() {
        var lastTime = 0;
        var vendors = ['ms', 'moz', 'webkit', 'o'];
        for (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {
            window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];
            window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] || window[vendors[x] + 'CancelRequestAnimationFrame'];
        }
        if (!window.requestAnimationFrame) window.requestAnimationFrame = function(callback, element) {
            var currTime = new Date().getTime();
            var timeToCall = Math.max(0, 16 - (currTime - lastTime));
            var id = window.setTimeout(function() {
                callback(currTime + timeToCall);
            }, timeToCall);
            lastTime = currTime + timeToCall;
            return id;
        };
        if (!window.cancelAnimationFrame) window.cancelAnimationFrame = function(id) {
            clearTimeout(id);
        };
    }());



    // window.requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;
    var start = null;
    var ele = document.getElementById("test");
    var progress = 0;

    function step(timestamp) {
        if (progress < 100) {
            progress += 1;
            ele.style.width = progress + "%";
            ele.innerHTML = progress + "%";
            start && cancelAnimationFrame(start);
            start = requestAnimationFrame(step);
        }
    }
    requestAnimationFrame(step);
    document.getElementById("run").addEventListener("click", function() {
        ele.style.width = "1px";
        progress = 0;
        requestAnimationFrame(step);
    }, false);


    var _ = {}
    //兼容  替代函数
    _.polyfill = function(obj, arr, fn) {
        for (var i = 0, len = arr.length; i < len; i++) {
            var f = obj[arr[i]];
            if (_.isFunction(f)) {
                if (i == 0) {
                    return f;
                } else {
                    return obj[arr[0]] = f;
                }
            }
        }
        return obj[arr[0]] = fn;
    }


    _.polyfill(Element.prototype, ['matches', 'webkitMatchesSelector', 'mozMatchesSelector', 'msMatchesSelector', 'oMatchesSelector'], function(s) {
        // return [].indexOf.call(document.querySelectorAll(s), this) !== -1;
        var matches = document.querySelectorAll(s), //(this.document || this.ownerDocument)
            i = matches.length;
        while (--i >= 0 && matches.item(i) !== this) {}
        return i > -1;
    });


    _.selectorMatches = function(el, selector) {
        var p = Element.prototype;
        var f = p.matches || p.webkitMatchesSelector || p.mozMatchesSelector || p.msMatchesSelector ||
            function(s) { return [].slice.call(document.querySelectorAll(s)).indexOf(this) !== -1; };
        return f.call(el, selector);
    }
    </script>
</body>

</html>